# Seeding

Seeding is the process of populating a database with an initial set of data. This is often done during development and testing to ensure that the application has the necessary data to function correctly. We can also use it to help supply default data for a production environment.

## Creating Seeders

### Step 1: The Seed Data

The seed data must be stored in a known location for the seeder to find it. There are two supported methods of storing seed data:

#### Method A: Via JSON
**Location: `Backend/Database/Default`**

Each seed is stored in a JSON formatted file which contains an array of objects. Each object represents a record to be inserted into the database.

#### Method B: Via instanced models
**Location: `Backend/Database/Seeders`**

One or more instances of EF models are created inside alongside the seeder. Values are provided via their constructor.

>[!NOTE]
>* All values that are normally auto-generated by EF Core, are not autogenerated when seeded, and requires manual defining, including the entry ID.
>* All integer-based ID's should be negative.
>* Relationships must be manual linked via their ID's.
>* Seeding does not allow lists or other collections to be present in their respective lists. If you define a seeded entity which has seeded data in its lists, you will need to first seed the nested relationship and then remove it from the list, or split the seed into multiple parts.

### Step 2: The Seeder Interface
**Location: `Backend/Database/Interfaces`**

The generic `IDataSeeder<T>` interface defines a contract for seeders. Each seeder must implement this interface and provide the `InitializeData` method. The type is the EF model being seeded. `LoadSeed` is provided as a default interface method, with two additional overloads.

```csharp
public interface IDataSeeder<T>
{
    void InitializeData();

    public static T? LoadSeed(string path)
    {
        ...
    }

    public static T LoadSeed(T model)
    {
        ...
    }

    public static List<T> LoadSeed(List<T> model)
    {
        ...
    }
}
```

The default interface methods can be accessed directly from the interface, or can be overridden in the implementing class.

### Step 3: The Seeder Class
**Location: `Backend/Database/Seeders`**

Each seeder class implements the `IDataSeeder<T>` interface. The `InitializeData` method is responsible for loading the seed data and configuring it with the `ModelBuilder`.

```csharp
public class MySeeder(ModelBuilder modelBuilder) : IDataSeeder<SomeModel>
{
    public void InitializeData()
    {
        SomeModel seedData = IDataSeeder<SomeModel>.LoadSeed("path/to/seed.json");
        modelBuilder.Entity<SomeModel>().HasData(seedData);
    }
}
```
And with collections:
```csharp
public class MySeeder(ModelBuilder modelBuilder) : IDataSeeder<SomeModel>
{
    public void InitializeData()
    {
        SomeModel seedData = IDataSeeder<SomeModel>.LoadSeed("path/to/seed.json");
        modelBuilder.Entity<SomeModel>().HasData(seedData.SomeCollection);

        seedData.SomeCollection = [];

        modelBuilder.Entity<SomeModel>().HasData(seedData);
    }
}
```
And with instanced models:
```csharp
public class MySeeder(ModelBuilder modelBuilder) : IDataSeeder<SomeModel>
{
    public void InitializeData()
    {
        SomeModel seedData = IDataSeeder<SomeModel>.LoadSeed(new SomeModel { ... });
        modelBuilder.Entity<SomeModel>().HasData(seedData);
    }
}
```
Or:
```csharp
public class MySeeder(ModelBuilder modelBuilder) : IDataSeeder<SomeModel>
{
    public void InitializeData()
    {
        SomeModel seedData = IDataSeeder<SomeModel>.LoadSeed(someModel);
        modelBuilder.Entity<SomeModel>().HasData(seedData);
    }

    SomeModel someModel = new() { ... };
}
```

## Advanced

### Automatic Seeder Execution
**Location: `Backend/Database/Utils`**

The `SeederHelper` class automatically discovers and executes all seeders that implement the `IDataSeeder<T>` interface. It uses reflection to find all seeder classes in the current assembly and invokes their `InitializeData` methods.