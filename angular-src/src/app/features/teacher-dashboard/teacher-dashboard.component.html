<div class="flex flex-col items-center w-full ">
  <div class="flex flex-col w-full max-w-full sm:max-w-4xl bg-white/90 shadow-xl rounded-2xl sm:p-10 border border-primary_dark_light">
    <h2 class="text-3xl font-bold text-primary_orange mb-6 text-center sm:text-left drop-shadow">
      <!-- Overview over active questionnaires. -->
       {{ 'TMP_OVERVIEW_ACTIVE_QUESTIONNAIRES' | translate }}
    </h2>

    <!-- Search & Filters Row -->
    <div class="grid grid-cols-1 sm:grid-cols-[auto_1fr_auto] gap-6 items-center w-full">
      <!-- Search & Filters -->
      <div class="flex flex-col sm:flex-row w-full gap-3">
        <select
          #searchSelect
          (change)="onSearchTypeChange(searchSelect.value)"
          class="border border-primary_orange rounded-lg px-3 py-2 focus:ring-primary_orange focus:border-primary_orange text-sm min-w-0 sm:min-w-[150px] bg-white/80"
        >
          <option value="name" selected>{{'TMP_SEARCH_BY_STUDENT_NAME'| translate}}</option> 
          <option value="id">{{'TMP_SEARCH_BY_QUESTIONNAIRE_ID'| translate}}</option>
        </select>

        <input
          #searchInput
          type="text"
          (input)="onSearchChange(searchInput.value)"
          placeholder="Search..."
          class="px-4 py-2 border border-primary_orange rounded-lg shadow-sm focus:ring-primary_orange focus:border-primary_orange text-sm w-full sm:flex-grow min-w-0 bg-white/80"
        />
      </div>

      <!-- Completion Filters -->
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
        <label class="flex items-center gap-2 text-primary_dark_light">
          <input
            type="checkbox"
            [(ngModel)]="filterStudentCompleted"
            (change)="onCompletionFilterChange()"
          />
          <span class="text-sm">Student is done</span>
        </label>
        <label class="flex items-center gap-2 text-primary_dark_light">
          <input
            type="checkbox"
            [(ngModel)]="filterTeacherCompleted"
            (change)="onCompletionFilterChange()"
          />
          <span class="text-sm">{{'TMP_TEACHER_DONE'| translate}}</span>
        </label>
      </div>

      <!-- Page Size Selector -->
      <div class="flex w-full sm:w-auto flex-col sm:flex-row gap-2">
        <label for="pageSize" class="text-primary_dark_light font-medium"> {{'TMP_ITEMS_PER_PAGE'| translate}}</label>
        <select
          #pageSize
          id="pageSize"
          (change)="onPageSizeChange(pageSize.value)"
          class="border border-primary_orange rounded-lg px-3 py-2 focus:ring-primary_orange focus:border-primary_orange text-sm w-full sm:w-auto bg-white/80"
        >
          <option *ngFor="let size of pageSizeOptions" [value]="size" [selected]="isSelectedPageSize(size)">
            {{ size }}
          </option>
        </select>
      </div>
    </div>

    <div class="flex justify-center items-center min-h-[150px]" *ngIf="isLoading">
      <app-loading></app-loading>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="text-center p-4">
      <p class="text-accent_red font-semibold text-lg">{{ errorMessage }}</p>
    </div>

    <ul class="space-y-6 mt-8" *ngIf="!isLoading && !errorMessage">
      <li
        *ngFor="let questionnaire of displayedQuestionnaires"
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center border border-primary_orange rounded-xl shadow bg-white/80 p-6 hover:shadow-lg transition-shadow duration-200"
      >
        <div class="flex flex-col gap-3 w-full sm:w-auto">
          <div class="flex flex-col sm:flex-row sm:items-center sm:gap-4">
            <span class="font-bold text-primary_dark text-lg">{{ questionnaire.title }}</span>
            <span class="text-sm text-secondary_gray">
              ID: {{ questionnaire.id }}
              <button
              *ngIf="!questionnaire.teacherCompletedAt || !questionnaire.studentCompletedAt"
              (click)="copyAnswersUrl(questionnaire.id)"
              class="ml-2 cursor-pointer text-orange-600 font-medium hover:text-orange-700 underline underline-offset-2 transition"
            >
              {{'TMP_COPY_LINK' | translate}}
            </button>

            </span>
          </div>

          <div *ngIf="questionnaire.student" class="flex flex-col sm:flex-row gap-2">
            <span class="text-sm text-primary_dark_light">
              {{'TMP_STUDENT_NAME'| translate}} {{ questionnaire.student.fullName }} ({{questionnaire.student.userName}})
            </span>
          </div>

          <div class="flex flex-col sm:flex-row gap-2">
            <span
              class="px-3 py-1 rounded-full text-sm font-medium text-white"
              [ngClass]="questionnaire.studentCompletedAt ? 'bg-accent_green' : 'bg-accent_red'"
            >
             {{'TMP_STUDENT'| translate}} {{ questionnaire.studentCompletedAt ? ('TMP_COMPLETED' | translate) : ('TMP_PENDING' | translate) }}
            </span>
            <span
              class="px-3 py-1 rounded-full text-sm font-medium text-white"
              [ngClass]="questionnaire.teacherCompletedAt ? 'bg-accent_green' : 'bg-accent_red'"
            >
              {{'TMP_TEACHER'|translate}} {{ questionnaire.teacherCompletedAt ? ('TMP_COMPLETED' | translate) : ('TMP_PENDING' | translate) }}
            </span>
          </div>
        </div>

        <div class="mt-4 sm:mt-0 flex gap-2">
          <button
            *ngIf="!questionnaire.teacherCompletedAt"
            [routerLink]="['/answer', questionnaire.id]"
            class="px-4 py-2 text-sm bg-primary_orange text-white rounded-md hover:bg-primary_orange_light focus:outline-none"
          >
          {{ 'TMP_ANSWER' | translate }}
            <!-- Answer  -->
          </button>

          <button
            *ngIf="questionnaire.teacherCompletedAt && questionnaire.studentCompletedAt"
            [routerLink]="['/results', questionnaire.id]"
            class="px-4 py-2 text-sm bg-secondary_blue text-white rounded-md hover:bg-primary_orange focus:outline-none"
          >
          {{ 'TMP_VIEW_RESULTS' | translate }}
            <!-- View Results -->
          </button>
        </div>
      </li>
    </ul>

    <app-pagination
      *ngIf="!isLoading && !errorMessage"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
      class="mt-8"
    >
    </app-pagination>
  </div>
</div>
