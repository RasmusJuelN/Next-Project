@if (!isLoading) {
  <div class="flex flex-col h-full items-center justify-center">
    @if (errorMessage) {
      <div class="text-center p-4">
        <p class="text-red-500 font-semibold text-lg">
          {{ errorMessage }}
        </p>
      </div>
    } @else {
      <div class="bg-primary_background_white/80 shadow-primary_orange_1/20 p-8 rounded-lg shadow-2xl border-2 border-primary_orange_1 w-full max-w-[1000px] min-w-[320px] sm:min-w-[600px] lg:min-w-[900px] min-h-[350px] max-h-[80vh] overflow-hidden flex flex-col overflow-y-auto custom-scrollbar">
        <!-- Fixed Header -->
        <div class=" px-4 rounded-xl mb-8 ">
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-2xl font-bold text-primary_dark_blue tracking-tight">
              {{ state.template.title }}
            </h2>
            @if (getCollaboratorInfo(); as collab) {
              <p class="text-gray-500 text-lg font-medium">
                {{ 'QUESTIONAIRE.COLLABORATOR' | translate }}: <span class="font-semibold text-primary_dark_blue">{{ collab }}</span>
              </p>
            }
          </div>
          <!-- Progress Section -->
          <div class="mb-0">
            <div class="flex justify-between items-center mb-2 gap-2">
              <h4 class="text-sm font-semibold text-primary_dark_blue w-[60px] text-center">
                {{ state.currentQuestionIndex + 1 }} / {{ state.template.questions.length }}
              </h4>
              <div class="w-full h-4 bg-secondary_background_gray rounded-full overflow-hidden ">
                <div
                  class="h-full rounded-full transition-all duration-500 ease-in-out bg-gradient-to-r from-primary_orange_light to-primary_orange_1"
                  [style.width.%]="state.progress"
                ></div>
              </div>
              <span class="text-sm text-primary_orange_1 font-bold w-[60px] text-center">
                {{ (state.progress | number:'1.0-0') }}%
              </span>
            </div>
          </div>
        </div>
        <!-- Question Content -->
        <div class="flex-grow mb-2">
          <app-question
            [question]="currentQuestion"
            [answer]="currentAnswer"
            (answerChange)="onAnswerChange($event)"
          ></app-question>
        </div>
        <!-- Navigation Buttons -->
        <div class="flex flex-wrap gap-4 justify-between items-center mt-2">
          <button
            class="bg-primary_orange_1 text-white font-semibold py-2 px-6 rounded-xl shadow hover:bg-primary_orange_light disabled:bg-primary_orange_1/50 disabled:text-white/80 disabled:cursor-not-allowed w-full sm:w-auto transition"
            [disabled]="state.currentQuestionIndex === 0"
            (click)="previousQuestion()"
            >
            {{ 'COMMON.BUTTONS.PREVIOUS' | translate }}
          </button>
          @if (state.currentQuestionIndex < state.template.questions.length - 1) {
            <button
              class="bg-primary_orange_1 text-white font-semibold py-2 px-6 rounded-xl shadow hover:bg-primary_orange_light disabled:bg-primary_orange_1/50 disabled:text-white/80 disabled:cursor-not-allowed w-full sm:w-auto transition"
              [disabled]="!isAnswered"
              (click)="nextQuestion()"
              >
              {{ 'COMMON.BUTTONS.NEXT' | translate }}
            </button>
          }
          @if (state.currentQuestionIndex === state.template.questions.length - 1) {
            <button
  class="bg-gradient-to-r from-primary_dark_light to-primary_dark_dark text-gray-100 font-bold py-2 px-6 rounded-xl shadow
         hover:brightness-110 hover:bg-gradient-to-r hover:from-primary_dark_dark hover:to-primary_dark_light
         hover:text-white
         focus:outline-none focus:ring-2 focus:ring-primary_orange_1
         disabled:from-primary_dark_light/40 disabled:to-primary_dark_dark/40 disabled:cursor-not-allowed
         w-full sm:w-auto transition-all duration-200 ease-in-out"
              [disabled]="!allQuestionsAnswered"
              (click)="submitQuestionnaire()"
              style="will-change: transform;"
              [ngClass]="{'hover:scale-[1.04]': true}"
              >
              {{ 'COMMON.BUTTONS.SUBMIT' | translate }}
            </button>
          }
        </div>
      </div>
    }
    <app-modal
      [isOpen]="showSubmitConfirmModal"
      [title]="'TMP_CONFIRM_SUBMIT_TITLE' | translate"
      [text]="'TMP_CONFIRM_SUBMIT_TEXT' | translate"
      [confirmText]="'COMMON.BUTTONS.SUBMIT' | translate"
      [cancelText]="'COMMON.BUTTONS.CANCEL' | translate"
      (confirm)="onConfirmSubmit()"
      (cancel)="onCancelSubmit()">
    </app-modal>
  </div>
}