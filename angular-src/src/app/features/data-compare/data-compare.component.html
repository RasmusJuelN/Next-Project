<!--
    DataCompareComponent HTML
    - Student and template search areas
    - Chart update and type selection
    - Question and year navigation
    - Chart display
-->
<div class="flex flex-col items-center w-full px-4">
    <!-- Main card container -->
    <div
        class="flex flex-col w-full max-w-full sm:max-w-4xl bg-primary_background_white/80 shadow-xl rounded-2xl sm:p-10 border-primary_dark_blue: px-4 py-2 border-2 border-primary_orange_1  focus:ring-primary_orange_1 focus:border-primary_orange_1 text-sm  bg-gray-50">
        <!-- Title -->
        <h2 class="text-3xl font-bold text-primary_dark_blue mb-6 text-center">{{'TMP_DATA_COMPARE_TITLE' | translate}}
        </h2>
        <!-- Search areas for students and templates -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full">
            <!-- Template search area -->
            <div class="flex flex-col w-full mt-4 sm:mt-0 relative" #templateSearchArea>
                <label class="text-primary_dark_blue text-sm mb-1 sm:mb-2">{{ 'DATA_COMPARE.SEARCH_TEMPLATE_LABEL' |
                    translate }}</label>
                <!-- Template search input -->
                <input type="text" placeholder="Indtast skabelontitel..." [(ngModel)]="template.searchInput"
                    (input)="onInputChange('template', templateSearch.value)" (focus)="showTemplateResults = true"
                    class="px-4 py-2 border border-primary_orange_1 rounded-xl shadow-sm focus:ring-primary_orange_1 focus:border-primary_orange_1 text-sm w-full bg-gray-50"
                    [placeholder]="'DATA_COMPARE.SEARCH_TEMPLATE_PLACEHOLDER' | translate" #templateSearch />

                <!-- Loading indicator for template search -->
                <div *ngIf="template.isLoading" class="text-blue-500 text-sm mt-2">
                    {{ 'DATA_COMPARE.LOADING_TEMPLATES' | translate }}
                </div>

                <!-- Error message for template search -->
                <div *ngIf="template.errorMessage" class="text-red-500 text-sm mt-2">
                    {{ template.errorMessage }}
                </div>

                <!-- Template search results and load more button (between input and selected list, not absolute) -->
                <div *ngIf="template.searchResults.length > 0 && showTemplateResults"
                    class="absolute z-30 left-0 right-0 top-16 bg-white shadow-md rounded-lg p-2 w-full max-h-60 overflow-auto border border-primary_orange_1 mt-1">
                    <ul class="space-y-1">
                        <li *ngFor="let temp of template.searchResults" (click)="select('template', temp)"
                            class="py-2 px-4 hover:bg-secondary_background_hover cursor-pointer rounded">
                            {{ temp.title }}
                        </li>
                    </ul>

                    <!-- Load More Button -->
                    <button *ngIf="template.page < template.totalPages"
                        class="mt-2 w-full px-4 py-2 bg-primary_orange_1 hover:bg-primary_orange_light text-white text-center font-medium rounded-xl border-2 border-primary_orange_1 hover:border-primary_dark_blue transition-colors">
                        {{ 'DATA_COMPARE.LOAD_MORE_TEMPLATES' | translate }}
                    </button>
                </div>

                <!-- Selected templates list -->
                <div *ngIf="template.selected.length > 0"
                    class="mt-2 text-sm font-medium text-gray-700 bg-gray-100 p-2 rounded-lg">
                    <strong>{{ 'DATA_COMPARE.SELECTED_TEMPLATES' | translate }}</strong>
                    <ul class="mt-1 space-y-1">
                        <li *ngFor="let temp of template.selected" class="flex justify-between items-center">
                            <span>{{ temp.title }}</span>
                            <button (click)="select('template', temp)"
                                class="ml-2 px-2 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded">{{
                                'DATA_COMPARE.REMOVE' | translate }}</button>
                        </li>
                    </ul>
                    <button (click)="clearSelected('template')"
                        class="mt-2 px-2 py-1 text-xs bg-gray-400 hover:bg-gray-500 text-white rounded">{{
                        'DATA_COMPARE.CLEAR_ALL' | translate }}</button>
                </div>
            </div>


            <!-- Student search area -->
            <div class="flex flex-col w-full relative" #studentSearchArea>
                <label class="text-gray-700 text-sm mb-1 sm:mb-2">{{ 'DATA_COMPARE.SEARCH_STUDENT_LABEL' | translate
                    }}</label>
                <!-- Student search input -->
                <input type="text" placeholder="Indtast navn pÃ¥ elever..." [(ngModel)]="student.searchInput"
                    (input)="onInputChange('student', studentSearch.value)" (focus)="showStudentResults = true"
                    class="px-4 py-2 border border-primary_orange_1 rounded-xl shadow-sm focus:ring-primary_orange_1 focus:border-primary_orange_1 text-sm w-full bg-gray-50"
                    [placeholder]="'DATA_COMPARE.SEARCH_STUDENT_PLACEHOLDER' | translate" #studentSearch />

                <!-- Loading indicator for student search -->
                <div *ngIf="student.isLoading" class="text-blue-500 text-sm mt-2">
                    {{ 'DATA_COMPARE.LOADING_STUDENTS' | translate }}
                </div>

                <!-- Error message for student search -->
                <div *ngIf="student.errorMessage" class="text-red-500 text-sm mt-2">
                    {{ student.errorMessage }}
                </div>

                <!-- Student search results and load more button (between input and selected list, not absolute) -->
                <div *ngIf="student.searchResults.length > 0 && showStudentResults"
                    class="absolute z-30 left-0 right-0 top-16 bg-white shadow-md rounded-lg p-2 w-full max-h-60 overflow-auto border border-primary_orange_1 mt-1">
                    <ul class="space-y-1">
                        <li *ngFor="let stud of student.searchResults" (click)="select('student', stud)"
                            class="py-2 px-4 hover:bg-secondary_background_hover cursor-pointer rounded">
                            <ng-container *ngIf="stud.type === 'user'; else groupResult">
                                <span>{{ stud.fullName }}<span *ngIf="stud.userName"> ({{ stud.userName }})</span></span>
                            </ng-container>
                            <ng-template #groupResult>
                                <span class="font-semibold text-primary_dark_blue">{{ stud.type === 'group' ? stud.name : '' }}</span>
                                <span class="ml-2 text-xs text-gray-500">[Gruppe]</span>
                            </ng-template>
                        </li>
                    </ul>

                    <!-- Load More Button -->
                    <button *ngIf="student.page < student.totalPages"
                        class="mt-2 w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-center font-medium rounded-lg transition">
                        {{ 'DATA_COMPARE.LOAD_MORE_STUDENTS' | translate }}
                    </button>
                </div>

                <!-- Selected students list -->
                <div *ngIf="student.selected.length > 0"
                    class="mt-2 text-sm font-medium text-gray-700 bg-gray-100 p-2 rounded-lg">
                    <strong>{{ 'DATA_COMPARE.SELECTED_STUDENTS' | translate }}</strong>
                    <ul class="mt-1 space-y-1">
                        <li *ngFor="let stud of student.selected" class="flex justify-between items-center">
                            <ng-container *ngIf="stud.type === 'user'; else selectedGroup">
                                <span>{{ stud.fullName }}<span *ngIf="stud.userName"> ({{ stud.userName
                                        }})</span></span>
                            </ng-container>
                            <ng-template #selectedGroup>
                                <span class="font-semibold text-primary_dark_blue">{{ stud.type === 'group' ? stud.name
                                    : '' }}</span>
                                <span class="ml-2 text-xs text-gray-500">[Gruppe]</span>
                            </ng-template>
                            <button (click)="select('student', stud)"
                                class="ml-2 px-2 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded">{{
                                'DATA_COMPARE.REMOVE' | translate }}</button>
                        </li>
                    </ul>
                    <button (click)="clearSelected('student')"
                        class="mt-2 px-2 py-1 text-xs bg-gray-400 hover:bg-gray-500 text-white rounded">{{
                        'DATA_COMPARE.CLEAR_ALL' | translate }}</button>
                </div>
            </div>


        </div>
        <!-- Chart update and type selection -->
        <!-- <div class="flex justify-center items-center mt-6 gap-4"> -->
        <!-- Update chart button -->
        <!-- <div class="flex items-center gap-4">
                <button (click)="onCompareClick()" [disabled]="!template.selected.length"
                    class="transition-all h-[50px] duration-150 px-6 py-3 rounded-xl shadow bg-gradient-to-r from-primary_orange_1 to-primary_orange_light text-white font-bold text-lg hover:from-primary_orange_light hover:to-primary_orange_1 active:scale-95 border-2 border-primary_orange_1 hover:border-primary_dark_blue disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    {{ 'DATA_COMPARE.UPDATE_CHART' | translate }}
                </button>

            </div> -->
        <!-- Chart type selector -->

        <!-- </div> -->


        <!-- Question and year navigation -->
        <div class="flex justify-center items-center mt-4 gap-4">
            <div class="flex flex-col gap-4">
                <!-- Question navigation buttons -->
                <div class="flex items-center gap-2 justify-center">
                    <button (click)="prevQuestion()" [disabled]="currentQuestionIndex === 0"
                        class="transition-all duration-150 px-4 py-2 rounded-xl shadow bg-gradient-to-r from-primary_orange_1 to-primary_orange_light text-white font-bold text-lg hover:from-primary_orange_light hover:to-primary_orange_1 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <span class="text-lg font-semibold text-primary_orange_1 mx-2">
                        {{ currentQuestionIndex + 1 }} / {{ questions.length }}
                    </span>
                    <button (click)="nextQuestion()" [disabled]="currentQuestionIndex === questions.length - 1"
                        class="transition-all duration-150 px-4 py-2 rounded-xl shadow bg-gradient-to-r from-primary_orange_1 to-primary_orange_light text-white font-bold text-lg hover:from-primary_orange_light hover:to-primary_orange_1 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>

                    <div class="flex items-center gap-2 justify-center ml-6">
                        <button (click)="prevYear()" [disabled]="currentYearIndex === 0"
                            class="transition-all duration-150 px-4 py-2 rounded-xl shadow bg-gradient-to-r from-primary_orange_1 to-primary_orange_light text-white font-bold text-lg hover:from-primary_orange_light hover:to-primary_orange_1 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <span class="text-lg font-semibold text-primary_orange_1 mx-2">
                            {{ years[currentYearIndex] || 'xxxx' }}
                        </span>
                        <button (click)="nextYear()" [disabled]="currentYearIndex === years.length - 1"
                            class="transition-all duration-150 px-4 py-2 rounded-xl shadow bg-gradient-to-r from-primary_orange_1 to-primary_orange_light text-white font-bold text-lg hover:from-primary_orange_light hover:to-primary_orange_1 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                    <div class="text-lg font-semibold  ml-6">
                        <div class="relative inline-block">
                            <select [(ngModel)]="chartType" (change)="updateChartForCurrentQuestion()"
                                class="appearance-none px-4 py-3 rounded-xl border border-primary_orange_1 bg-white text-sm w-[125px] h-[45px] font-medium cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary_orange_1">
                                <option value="pie">{{ 'DATA_COMPARE.PIE_CHART' | translate }}</option>
                                <option value="bar">{{ 'DATA_COMPARE.BAR_CHART' | translate }}</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                <svg class="w-4 h-4 text-primary_orange_1" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Chart display -->
        <div class=" flex justify-center mt-8 w-full">
            <ag-charts class="w-[1000px] h-[500px]" [options]="chartOptions"></ag-charts>
        </div>
    </div>