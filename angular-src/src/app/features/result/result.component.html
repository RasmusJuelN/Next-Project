<div *ngIf="isLoading" class="text-center text-gray-700">Indl√¶ser...</div>
<div *ngIf="errorMessage" class="text-center text-red-500">{{ errorMessage }}</div>

<div *ngIf="result" class="answer-session bg-gray-100 p-4 sm:p-6 max-w-7xl mx-auto print:bg-white print:shadow-none print:p-0 print:overflow-visible">
  <!-- Action Buttons - Mobile friendly layout -->
  <div class="flex flex-col sm:flex-row sm:justify-between items-start sm:items-center mb-6 print:hidden gap-4">
    <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 print:text-black order-2 sm:order-1">
      {{ translate.instant('RESULT.TEMPLATE_TITLE') }} {{ result.title }}
    </h2>
    
    <div class="flex flex-wrap gap-2 order-1 sm:order-2 w-full sm:w-auto">
      <!-- Toggle View Button -->
      <button
        (click)="toggleView()"
        class="bg-purple-500 text-white px-3 py-2 text-sm rounded hover:bg-purple-600 flex-1 sm:flex-none min-w-0"
        [title]="translate.instant('RESULT.TOGGLE_VIEW_TOOLTIP')"
      >
        <span class="hidden sm:inline">{{ isFullView ? translate.instant('RESULT.COMPRESSED_VIEW') : translate.instant('RESULT.FULL_VIEW') }}</span>
        <span class="sm:hidden">{{ isFullView ? translate.instant('RESULT.COMPRESSED_VIEW_SHORT') : translate.instant('RESULT.FULL_VIEW_SHORT') }}</span>
      </button>
      
      <!-- PDF Buttons -->
      <button
        (click)="openPdf()"
        class="bg-green-500 text-white px-3 py-2 text-sm rounded hover:bg-green-600 flex-1 sm:flex-none"
        [title]="translate.instant('RESULT.OPEN_PDF_TOOLTIP')"
      >
        <span class="hidden sm:inline">{{ translate.instant('RESULT.OPEN_PDF') }}</span>
        <span class="sm:hidden">{{ translate.instant('RESULT.OPEN_PDF_SHORT') }}</span>
      </button>
      
      <button
        (click)="generatePdf()"
        class="bg-blue-500 text-white px-3 py-2 text-sm rounded hover:bg-blue-600 flex-1 sm:flex-none"
        [title]="translate.instant('RESULT.DOWNLOAD_PDF_TOOLTIP')"
      >
        <span class="hidden sm:inline">{{ translate.instant('RESULT.DOWNLOAD_PDF') }}</span>
        <span class="sm:hidden">{{ translate.instant('RESULT.DOWNLOAD_PDF_SHORT') }}</span>
      </button>
      
      <button
        (click)="printPage()"
        class="bg-gray-500 text-white px-3 py-2 text-sm rounded hover:bg-gray-600 flex-1 sm:flex-none"
        [title]="translate.instant('RESULT.PRINT_TOOLTIP')"
      >
        <span class="hidden sm:inline">{{ translate.instant('RESULT.PRINT') }}</span>
        <span class="sm:hidden">{{ translate.instant('RESULT.PRINT_SHORT') }}</span>
      </button>
    </div>
  </div>

  <!-- Template ID -->
  <h3 class="text-lg font-medium text-gray-700 mb-6">ID: {{ result.id }}</h3>

  <!-- User Info Section - Mobile Responsive -->
  <div class="user-info-section mb-8 border-b print:border-gray-400 pb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Student Info -->
      <div class="info-item bg-white p-4 rounded-lg shadow-sm border">
        <span class="block font-bold text-gray-700 print:text-black mb-2">{{ translate.instant('RESULT.STUDENT_LABEL') }}</span>
        <span class="block text-gray-900 print:text-black font-medium mb-1 break-words">{{ result.student.user.fullName }}</span>
        <span class="block text-sm text-gray-500 print:text-black break-words">
          {{ translate.instant('RESULT.COMPLETED_ON') }} {{ result.student.completedAt | date:'short' }}
        </span>
      </div>
    
      <!-- Teacher Info -->
      <div class="info-item bg-white p-4 rounded-lg shadow-sm border">
        <span class="block font-bold text-gray-700 print:text-black mb-2">{{ translate.instant('RESULT.TEACHER_LABEL') }}</span>
        <span class="block text-gray-900 print:text-black font-medium mb-1 break-words">{{ result.teacher.user.fullName }}</span>
        <span class="block text-sm text-gray-500 print:text-black break-words">
          {{ translate.instant('RESULT.COMPLETED_ON') }} {{ result.teacher.completedAt | date:'short' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Compressed View - Mobile Responsive -->
  <div *ngIf="!isFullView" class="questions-section space-y-8">
    <div *ngFor="let answer of result.answers; let i = index" class="question-answer-pair print:break-inside-avoid bg-white rounded-lg shadow-sm border p-4 sm:p-6">
      <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-4 print:text-black break-words">
        {{ i + 1 }}. {{ answer.question }}
      </h3>

      <div class="answers-comparison grid grid-cols-1 lg:grid-cols-2 gap-4 print:grid-cols-1 print:border-b print:pb-4 print:mb-4">
        
        <!-- Student Answer -->
        <div class="answer-container bg-gray-50 p-3 sm:p-4 rounded-lg print:bg-transparent print:p-0 order-1">
          <span class="block font-bold text-gray-700 print:text-black mb-2">{{ translate.instant('RESULT.STUDENT_LABEL') }}:</span>
          <p class="text-gray-900 print:text-black break-words mb-2">{{ answer.studentResponse }}</p>
          <span *ngIf="answer.isStudentResponseCustom" class="inline-block text-xs sm:text-sm bg-blue-100 text-blue-600 px-2 py-1 rounded">{{ translate.instant('RESULT.CUSTOM_ANSWER') }}</span>
        </div>

        <!-- Teacher Answer -->
        <div class="answer-container bg-gray-50 p-3 sm:p-4 rounded-lg print:bg-transparent print:p-0 order-2">
          <span class="block font-bold text-gray-700 print:text-black mb-2">{{ translate.instant('RESULT.TEACHER_LABEL') }}:</span>
          <p class="text-gray-900 print:text-black break-words mb-2">{{ answer.teacherResponse }}</p>
          <span *ngIf="answer.isTeacherResponseCustom" class="inline-block text-xs sm:text-sm bg-blue-100 text-blue-600 px-2 py-1 rounded">{{ translate.instant('RESULT.CUSTOM_ANSWER') }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Full View (PDF-like Matrix Style) - Mobile Responsive -->
  <div *ngIf="isFullView" class="questions-section space-y-8">
    <div *ngFor="let answer of result.answers; let i = index" class="question-block print:break-inside-avoid bg-white rounded-lg shadow-sm border p-4 sm:p-6">
      <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-4 print:text-black break-words">
        {{ i + 1 }}. {{ answer.question }}
      </h3>

      <ng-container *ngIf="getTemplateQuestionOptions(answer.question) as options">
        <!-- Matrix Table with horizontal scroll for mobile -->
        <div *ngIf="options.length > 0 && (!answer.isStudentResponseCustom || !answer.isTeacherResponseCustom)" 
             class="matrix-table mb-4">
          
          <!-- Scrollable container for mobile -->
          <div class="overflow-x-auto border border-gray-300 rounded">
            <table class="min-w-full border-collapse">
              <thead>
                <tr class="bg-blue-50">
                  <th class="border border-gray-300 p-2 text-left font-medium text-gray-700 min-w-[80px] sticky left-0 bg-blue-50 z-10"></th>
                  <th *ngFor="let option of options" 
                      class="border border-gray-300 p-2 text-center font-medium text-gray-700 text-xs sm:text-sm min-w-[120px] sm:min-w-[150px]">
                    <div class="break-words leading-tight">
                      {{ option.displayText }}
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <!-- Student row (only if not custom) -->
                <tr *ngIf="!answer.isStudentResponseCustom">
                  <td class="border border-gray-300 p-2 font-semibold bg-white sticky left-0 z-10 min-w-[80px]">
                    {{ translate.instant('RESULT.STUDENT_LABEL') }}
                  </td>
                  <td *ngFor="let option of options; let optionIndex = index" 
                      class="border border-gray-300 p-2 text-center min-w-[120px] sm:min-w-[150px]">
                    <span *ngIf="isOptionSelected(answer.studentResponse, answer.isStudentResponseCustom, option, optionIndex)" 
                          class="font-bold text-lg text-gray-800">X</span>
                  </td>
                </tr>
                <!-- Teacher row (only if not custom) -->
                <tr *ngIf="!answer.isTeacherResponseCustom">
                  <td class="border border-gray-300 p-2 font-semibold bg-white sticky left-0 z-10 min-w-[80px]">
                    {{ translate.instant('RESULT.TEACHER_LABEL') }}
                  </td>
                  <td *ngFor="let option of options; let optionIndex = index" 
                      class="border border-gray-300 p-2 text-center min-w-[120px] sm:min-w-[150px]">
                    <span *ngIf="isOptionSelected(answer.teacherResponse, answer.isTeacherResponseCustom, option, optionIndex)" 
                          class="font-bold text-lg text-gray-800">X</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- No options note -->
        <div *ngIf="options.length === 0" class="bg-gray-50 p-3 rounded border mb-4">
          <p class="text-sm text-gray-600 italic">{{ translate.instant('RESULT.NO_OPTIONS_AVAILABLE') }}</p>
        </div>
      </ng-container>

      <!-- Custom Responses Section - Mobile Responsive -->
      <div *ngIf="answer.isStudentResponseCustom || answer.isTeacherResponseCustom" 
           class="custom-responses bg-gray-50 p-3 sm:p-4 rounded border">
        <h4 class="font-semibold text-gray-700 mb-3 text-sm sm:text-base">{{ translate.instant('RESULT.CUSTOM_RESPONSES') }}</h4>
        
        <!-- Student custom response -->
        <div *ngIf="answer.isStudentResponseCustom" class="custom-response mb-3 p-2 bg-white rounded">
          <div class="flex flex-col sm:flex-row">
            <span class="font-medium text-gray-600 mb-1 sm:mb-0 sm:w-20 sm:flex-shrink-0 italic text-sm">
              {{ translate.instant('RESULT.STUDENT_LABEL') }}:
            </span>
            <span class="text-gray-900 break-words text-sm">{{ answer.studentResponse }}</span>
          </div>
        </div>
        
        <!-- Teacher custom response -->
        <div *ngIf="answer.isTeacherResponseCustom" class="custom-response p-2 bg-white rounded">
          <div class="flex flex-col sm:flex-row">
            <span class="font-medium text-gray-600 mb-1 sm:mb-0 sm:w-20 sm:flex-shrink-0 italic text-sm">
              {{ translate.instant('RESULT.TEACHER_LABEL') }}:
            </span>
            <span class="text-gray-900 break-words text-sm">{{ answer.teacherResponse }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<label for="charts">Change Chart Type : </label>
<select name="charts" id="charts" [(ngModel)]="chartType" (change)="updateChart(chartType)">
  <option value="stacked">Stacked Chart</option>
  <option value="donut">Donut Chart</option>
</select>
<div class="flex justify-center mt-8 w-full" *ngIf="chartOptions">
  <div class=" flex justify-center">
    <ag-charts class="w-[800px] h-[500px]" [options]="chartOptions"></ag-charts>
  </div>
</div>